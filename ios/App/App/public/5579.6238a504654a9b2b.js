"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5579],{5579:(j,U,u)=>{u.r(U),u.d(U,{UserListPageModule:()=>T});var d=u(177),g=u(9417),n=u(4742),f=u(9192),m=u(467),p=u(4843),e=u(4438),h=u(9626);function b(r,l){if(1&r){const s=e.RV6();e.j41(0,"ion-button",10),e.bIt("click",function(){e.eBV(s);const o=e.XpG().$implicit,t=e.XpG(2);return e.Njj(t.editUser(o))})("click",function(o){return e.eBV(s),e.Njj(o.stopPropagation())}),e.nrm(1,"ion-icon",11),e.k0s()}}function L(r,l){if(1&r){const s=e.RV6();e.j41(0,"ion-button",12),e.bIt("click",function(){e.eBV(s);const o=e.XpG().$implicit,t=e.XpG(2);return e.Njj(t.deleteUser(o.id))})("click",function(o){return e.eBV(s),e.Njj(o.stopPropagation())}),e.nrm(1,"ion-icon",13),e.k0s()}}function P(r,l){if(1&r){const s=e.RV6();e.j41(0,"ion-item",6),e.bIt("click",function(){const o=e.eBV(s).$implicit,t=e.XpG(2);return e.Njj(t.goToUserDetail(o))}),e.j41(1,"ion-label")(2,"h2"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s()(),e.j41(6,"ion-buttons",7),e.DNE(7,b,2,0,"ion-button",8)(8,L,2,0,"ion-button",9),e.k0s()()}if(2&r){const s=l.$implicit;e.R7$(3),e.JRh(s.nombre),e.R7$(2),e.JRh(s.rol),e.R7$(2),e.Y8G("ngIf",s.id),e.R7$(),e.Y8G("ngIf",s.id)}}function v(r,l){if(1&r&&(e.j41(0,"ion-list"),e.DNE(1,P,9,4,"ion-item",5),e.k0s()),2&r){const s=e.XpG();e.R7$(),e.Y8G("ngForOf",s.filteredUsuarios)}}const I=[{path:"",component:(()=>{var r;class l{constructor(i,o,t,a){this.userService=i,this.router=o,this.alertController=t,this.ngZone=a,this.usuarios=[],this.filteredUsuarios=[],this.filterTerm=""}ngOnInit(){}ionViewWillEnter(){this.loadUsuarios()}loadUsuarios(){var i=this;return(0,m.A)(function*(){try{const o=yield i.userService.getUsuariosSQLite();console.log("Usuarios locales obtenidos de SQLite:",o),i.ngZone.run(()=>{i.usuarios=o,i.filteredUsuarios=o}),navigator.onLine&&i.userService.getUsuariosAPI().subscribe(t=>{i.ngZone.run(()=>{if(t&&t.length>0){const a=t.filter(c=>!i.usuarios.some(_=>_.id===c.id));i.usuarios=[...i.usuarios,...a],i.filteredUsuarios=i.usuarios,console.log("Usuarios combinados (sin duplicados):",i.usuarios)}else i.usuarios=o,i.filteredUsuarios=o,console.log("Solo mostrando usuarios locales:",i.usuarios)})},t=>{console.error("Error obteniendo usuarios de la API:",t),i.ngZone.run(()=>{i.usuarios=o,i.filteredUsuarios=o})})}catch(o){console.error("Error al cargar usuarios:",o)}})()}filterUsers(i){var o;const t=null===(o=i.target.value)||void 0===o?void 0:o.toLowerCase();this.filteredUsuarios=t&&""!==t.trim()?this.usuarios.filter(a=>a.nombre.toLowerCase().includes(t)):this.usuarios}deleteUser(i){var o=this;return(0,m.A)(function*(){var a;void 0!==i?yield(yield o.alertController.create({header:"Confirmar",message:"\xbfEst\xe1s seguro de que deseas eliminar este usuario?",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Eliminaci\xf3n cancelada")}},{text:"Eliminar",handler:(a=(0,m.A)(function*(){try{const c=i.toString();if(yield o.userService.deleteUsuarioSQLite(c),console.log(`Usuario con ID ${c} eliminado de SQLite`),navigator.onLine)try{if(!(yield(0,p._)(o.userService.deleteUsuarioAPI(c))))throw new Error("Fall\xf3 la eliminaci\xf3n en la API");console.log(`Usuario con ID ${c} eliminado de la API`)}catch(_){console.error("Error al eliminar usuario de la API:",_)}else console.log("No hay conexi\xf3n a la red, no se puede eliminar de la API");o.loadUsuarios()}catch(c){console.error("Error al eliminar usuario:",c)}}),function(){return a.apply(this,arguments)})}]})).present():console.error("El ID del usuario es indefinido.")})()}editUser(i){i.id?this.router.navigate(["/usuarios/user-edit"],{state:{user:i}}):console.error("ID de usuario no v\xe1lido")}goToUserDetail(i){this.router.navigate(["/usuarios/user-detail"],{state:{user:i}})}goToAddUser(){this.router.navigate(["/usuarios/user-add"])}goToUserAll(){this.router.navigate(["/usuarios/user-all"])}}return(r=l).\u0275fac=function(i){return new(i||r)(e.rXU(h.D),e.rXU(f.Ix),e.rXU(n.hG),e.rXU(e.SKi))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-user-list"]],decls:11,vars:2,consts:[[1,"ion-padding"],["placeholder","Buscar usuario",3,"ngModelChange","ionInput","ngModel"],[4,"ngIf"],["expand","block","color","secondary",3,"click"],["expand","block","color","primary",1,"beautiful-button",3,"click"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["slot","end"],["fill","clear","color","primary",3,"click",4,"ngIf"],["fill","clear","color","danger",3,"click",4,"ngIf"],["fill","clear","color","primary",3,"click"],["name","create"],["fill","clear","color","danger",3,"click"],["name","trash"]],template:function(i,o){1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Lista de Usuarios"),e.k0s()()(),e.j41(4,"ion-content",0)(5,"ion-searchbar",1),e.mxI("ngModelChange",function(a){return e.DH7(o.filterTerm,a)||(o.filterTerm=a),a}),e.bIt("ionInput",function(a){return o.filterUsers(a)}),e.k0s(),e.DNE(6,v,2,1,"ion-list",2),e.j41(7,"ion-button",3),e.bIt("click",function(){return o.goToAddUser()}),e.EFF(8," Agregar Nuevo Usuario "),e.k0s(),e.j41(9,"ion-button",4),e.bIt("click",function(){return o.goToUserAll()}),e.EFF(10," Volver "),e.k0s()()),2&i&&(e.R7$(5),e.R50("ngModel",o.filterTerm),e.R7$(),e.Y8G("ngIf",o.filteredUsuarios.length>0))},dependencies:[d.Sq,d.bT,g.BC,g.vS,n.Jm,n.QW,n.W9,n.eU,n.iq,n.uz,n.he,n.nf,n.S1,n.BC,n.ai,n.Gw]}),l})()}];let k=(()=>{var r;class l{}return(r=l).\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[f.iI.forChild(I),f.iI]}),l})(),T=(()=>{var r;class l{}return(r=l).\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[d.MD,g.YN,n.bv,k]}),l})()}}]);