"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5220],{5220:(F,m,a)=>{a.r(m),a.d(m,{ProductListPageModule:()=>j});var g=a(177),_=a(9417),c=a(4742),p=a(9192),P=a(467),f=a(4843),t=a(4438),h=a(636),v=a(2872);function b(i,s){if(1&i&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&i){const n=s.$implicit;t.R7$(),t.E5c(" ",n.size," kg - $",n.price," - Stock: ",n.stock," ")}}function L(i,s){if(1&i&&(t.j41(0,"div")(1,"h3"),t.EFF(2,"Opciones de Peso:"),t.k0s(),t.j41(3,"ul"),t.DNE(4,b,2,3,"li",16),t.k0s()()),2&i){const n=t.XpG().$implicit;t.R7$(4),t.Y8G("ngForOf",n.weightOptions)}}function k(i,s){if(1&i){const n=t.RV6();t.j41(0,"ion-button",17),t.bIt("click",function(){t.eBV(n);const e=t.XpG().$implicit,r=t.XpG(2);return t.Njj(r.editProduct(e))})("click",function(e){return t.eBV(n),t.Njj(e.stopPropagation())}),t.nrm(1,"ion-icon",18),t.k0s()}}function x(i,s){if(1&i){const n=t.RV6();t.j41(0,"ion-button",19),t.bIt("click",function(){t.eBV(n);const e=t.XpG().$implicit,r=t.XpG(2);return t.Njj(r.deleteProduct(e.id))})("click",function(e){return t.eBV(n),t.Njj(e.stopPropagation())}),t.nrm(1,"ion-icon",20),t.k0s()}}function I(i,s){if(1&i){const n=t.RV6();t.j41(0,"ion-item",11),t.bIt("click",function(){const e=t.eBV(n).$implicit,r=t.XpG(2);return t.Njj(r.viewProductDetails(e))}),t.j41(1,"ion-thumbnail",12),t.nrm(2,"ion-img",13),t.k0s(),t.j41(3,"ion-label")(4,"h2"),t.EFF(5),t.k0s(),t.j41(6,"p"),t.EFF(7),t.k0s(),t.DNE(8,L,5,1,"div",5),t.k0s(),t.j41(9,"ion-buttons",2),t.DNE(10,k,2,0,"ion-button",14)(11,x,2,0,"ion-button",15),t.k0s()()}if(2&i){const n=s.$implicit;t.R7$(2),t.Y8G("src",n.imagen?n.imagen:"assets/logo_pawsy.png"),t.R7$(3),t.JRh(n.nombre),t.R7$(2),t.JRh(n.descripcion),t.R7$(),t.Y8G("ngIf",n.weightOptions&&n.weightOptions.length>0),t.R7$(2),t.Y8G("ngIf",n.id),t.R7$(),t.Y8G("ngIf",n.id)}}function C(i,s){if(1&i&&(t.j41(0,"ion-list"),t.DNE(1,I,12,6,"ion-item",10),t.k0s()),2&i){const n=t.XpG();t.R7$(),t.Y8G("ngForOf",n.filteredProducts)}}function y(i,s){1&i&&(t.j41(0,"div",21)(1,"p"),t.EFF(2,"No hay productos disponibles."),t.k0s()())}const O=[{path:"",component:(()=>{var i;class s{constructor(o,e,r,d,l,u){this.productService=o,this.router=e,this.alertController=r,this.ngZone=d,this.cdr=l,this.navCtrl=u,this.products=[],this.filteredProducts=[],this.filterTerm=""}ngOnInit(){}ionViewWillEnter(){this.loadProducts()}loadProducts(){var o=this;return(0,P.A)(function*(){try{const e=yield o.productService.getProductsSQLite();for(let r of e){const d=yield o.productService.getWeightOptionsByProductIdSQLite(r.id);r.weightOptions=d}if(console.log("Productos locales obtenidos de SQLite:",e),o.ngZone.run(()=>{o.products=e,o.filteredProducts=e}),navigator.onLine)try{const r=yield(0,f._)(o.productService.getProductsAPI());if(console.log("Productos obtenidos de la API:",r),r&&r.length>0){const d=r.filter(l=>!e.some(u=>u.id===l.id));for(let l of d)try{const u=yield(0,f._)(o.productService.getWeightOptionsByProductIdAPI(l.id));console.log(`Opciones de peso para el producto ${l.id}:`,u),l.weightOptions=u}catch(u){console.warn(`Error al obtener opciones de peso para el producto ${l.id}:`,u),l.weightOptions=[]}o.ngZone.run(()=>{o.products=[...e,...d],o.filteredProducts=o.products,console.log("Productos combinados (sin duplicados):",o.products)})}}catch(r){console.error("Error obteniendo productos de la API:",r),o.ngZone.run(()=>{o.products=e,o.filteredProducts=e})}else console.log("Sin conexi\xf3n a la red, mostrando solo productos locales.")}catch(e){console.error("Error al cargar productos:",e)}})()}filterProducts(o){var e;const r=null===(e=o.target.value)||void 0===e?void 0:e.toLowerCase();this.filteredProducts=r&&""!==r.trim()?this.products.filter(d=>d.nombre.toLowerCase().includes(r)):this.products}deleteProduct(o){var e=this;return(0,P.A)(function*(){var d;void 0!==o?yield(yield e.alertController.create({header:"Confirmar",message:"\xbfEst\xe1s seguro de que deseas eliminar este producto?",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Eliminaci\xf3n cancelada")}},{text:"Eliminar",handler:(d=(0,P.A)(function*(){try{const l=o.toString();if(yield e.productService.deleteProductWithWeightsSQLite(l),console.log(`Producto con ID ${l} eliminado de SQLite`),navigator.onLine)try{yield e.productService.deleteProductWithWeightsAPI(l),console.log(`Producto con ID ${l} eliminado de la API`)}catch(u){console.error("Error al eliminar producto de la API:",u)}else console.log("No hay conexi\xf3n a la red, no se puede eliminar de la API");e.loadProducts()}catch(l){console.error("Error al eliminar producto:",l)}}),function(){return d.apply(this,arguments)})}]})).present():console.error("El ID del producto es indefinido.")})()}editProduct(o){o.id?this.router.navigate(["/productos/product-edit"],{state:{product:o}}):console.error("ID de producto no v\xe1lido")}viewProductDetails(o){this.router.navigate(["/productos/product-detail"],{state:{product:o}})}addProduct(){this.router.navigate(["/productos/product-add"])}goBack(){this.navCtrl.navigateBack("/productos/product-all")}}return(i=s).\u0275fac=function(o){return new(o||i)(t.rXU(h.b),t.rXU(p.Ix),t.rXU(c.hG),t.rXU(t.SKi),t.rXU(t.gRc),t.rXU(v.q9))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-product-list"]],decls:16,vars:3,consts:[["color","primary"],[1,"ion-text-center"],["slot","end"],["routerLink","/productos/product-add","color","secondary"],["placeholder","Buscar producto",3,"ngModelChange","ionInput","ngModel"],[4,"ngIf"],["class","no-products",4,"ngIf"],["expand","full","color","secondary","routerLink","/productos/product-add"],["expand","full","color","light","routerLink","/productos/product-all"],["name","arrow-back"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["slot","start",1,"thumbnail-image"],[1,"product-image",3,"src"],["fill","clear","color","primary",3,"click",4,"ngIf"],["fill","clear","color","danger",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["fill","clear","color","primary",3,"click"],["name","create"],["fill","clear","color","danger",3,"click"],["name","trash"],[1,"no-products"]],template:function(o,e){1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),t.EFF(3,"Lista de Productos"),t.k0s(),t.j41(4,"ion-buttons",2)(5,"ion-button",3),t.EFF(6," Agregar Producto "),t.k0s()()()(),t.j41(7,"ion-content")(8,"ion-searchbar",4),t.mxI("ngModelChange",function(d){return t.DH7(e.filterTerm,d)||(e.filterTerm=d),d}),t.bIt("ionInput",function(d){return e.filterProducts(d)}),t.k0s(),t.DNE(9,C,2,1,"ion-list",5)(10,y,3,0,"div",6),t.j41(11,"ion-button",7),t.EFF(12," Agregar Nuevo Producto "),t.k0s(),t.j41(13,"ion-button",8),t.nrm(14,"ion-icon",9),t.EFF(15," Volver "),t.k0s()()),2&o&&(t.R7$(8),t.R50("ngModel",e.filterTerm),t.R7$(),t.Y8G("ngIf",e.filteredProducts.length>0),t.R7$(),t.Y8G("ngIf",0===e.filteredProducts.length))},dependencies:[g.Sq,g.bT,_.BC,_.vS,c.Jm,c.QW,c.W9,c.eU,c.iq,c.KW,c.uz,c.he,c.nf,c.S1,c.Zx,c.BC,c.ai,c.Gw,c.N7,p.Wk],styles:[".product-item[_ngcontent-%COMP%]{align-items:flex-start;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid #ddd}.product-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#333;margin:0}.product-description[_ngcontent-%COMP%]{font-size:.9rem;color:#666;margin:5px 0}.weight-options[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:5px;font-weight:700;color:#555;font-size:.9rem}.options-table[_ngcontent-%COMP%]{width:100%;margin-top:5px;border-collapse:collapse}.options-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .options-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:left;padding:5px;border-bottom:1px solid #ddd;font-size:.85rem}.product-category[_ngcontent-%COMP%]{margin-top:10px;font-size:.85rem;color:#777}.product-image[_ngcontent-%COMP%]{width:60px;height:60px;object-fit:cover;border-radius:8px}.thumbnail-image[_ngcontent-%COMP%]{margin-right:15px}.no-products[_ngcontent-%COMP%]{text-align:center;color:#999;font-size:1.2rem;margin-top:20px}.button-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;margin-top:5px}.button-group[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:5px;width:100px}"]}),s})()}];let M=(()=>{var i;class s{}return(i=s).\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[p.iI.forChild(O),p.iI]}),s})(),j=(()=>{var i;class s{}return(i=s).\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[g.MD,_.YN,c.bv,M]}),s})()}}]);