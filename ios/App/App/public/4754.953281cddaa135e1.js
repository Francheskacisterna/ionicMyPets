"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4754],{4754:(S,_,s)=>{s.r(_),s.d(_,{CarritoListPageModule:()=>R});var g=s(177),v=s(9417),c=s(4742),f=s(9192),u=s(467),h=s(4843),t=s(4438),y=s(224),I=s(636);function F(r,o){1&r&&(t.j41(0,"ion-card")(1,"ion-card-content")(2,"ion-text",5),t.EFF(3,"El carrito est\xe1 vac\xedo"),t.k0s()()())}function P(r,o){if(1&r&&(t.j41(0,"p"),t.EFF(1,"Peso: "),t.j41(2,"span"),t.EFF(3),t.k0s()()),2&r){const a=t.XpG().$implicit;t.R7$(3),t.SpI("",a.selectedWeight.size," kg")}}function b(r,o){if(1&r){const a=t.RV6();t.j41(0,"ion-item",7)(1,"ion-thumbnail",8),t.nrm(2,"img",9),t.k0s(),t.j41(3,"ion-label")(4,"h2"),t.EFF(5),t.k0s(),t.j41(6,"div",10)(7,"p"),t.EFF(8,"Cantidad: "),t.j41(9,"span"),t.EFF(10),t.k0s()(),t.j41(11,"p"),t.EFF(12,"Precio: "),t.j41(13,"span"),t.EFF(14),t.nI1(15,"currency"),t.k0s()(),t.DNE(16,P,4,1,"p",2),t.j41(17,"p"),t.EFF(18,"Total: "),t.j41(19,"span"),t.EFF(20),t.nI1(21,"currency"),t.k0s()()()(),t.j41(22,"div",11)(23,"ion-button",12),t.bIt("click",function(){const i=t.eBV(a).$implicit,n=t.XpG(2);return t.Njj(n.editCartItemQuantity(i))}),t.EFF(24,"Editar"),t.k0s(),t.j41(25,"ion-button",13),t.bIt("click",function(){const i=t.eBV(a).$implicit,n=t.XpG(2);return t.Njj(n.removeFromCart(i))}),t.EFF(26,"Eliminar"),t.k0s()()()}if(2&r){const a=o.$implicit;t.R7$(2),t.FS9("alt",a.productName),t.Y8G("src",a.imagen||"assets/default-image.png",t.B4B),t.R7$(3),t.JRh(a.productName),t.R7$(5),t.JRh(a.quantity),t.R7$(4),t.JRh(t.bMT(15,7,a.price)),t.R7$(2),t.Y8G("ngIf",a.selectedWeight),t.R7$(4),t.JRh(t.bMT(21,9,a.total))}}function L(r,o){if(1&r&&(t.j41(0,"ion-list"),t.DNE(1,b,27,11,"ion-item",6),t.k0s()),2&r){const a=t.XpG();t.R7$(),t.Y8G("ngForOf",a.cartItems)}}function j(r,o){if(1&r&&(t.j41(0,"ion-card")(1,"ion-card-content")(2,"ion-text",0)(3,"h2"),t.EFF(4),t.nI1(5,"currency"),t.k0s()()()()),2&r){const a=t.XpG();t.R7$(4),t.SpI("Total del Carrito: ",t.bMT(5,1,a.cartTotal),"")}}function T(r,o){if(1&r){const a=t.RV6();t.j41(0,"ion-button",14),t.bIt("click",function(){t.eBV(a);const i=t.XpG();return t.Njj(i.clearCart())}),t.EFF(1,"Vaciar Carrito"),t.k0s()}}function k(r,o){if(1&r){const a=t.RV6();t.j41(0,"ion-button",15),t.bIt("click",function(){t.eBV(a);const i=t.XpG();return t.Njj(i.goToPedidoAdd())}),t.EFF(1,"Crear Pedido"),t.k0s()}}const x=[{path:"",component:(()=>{var r;class o{constructor(e,i,n,d){this.cartService=e,this.productService=i,this.alertController=n,this.router=d,this.products=[],this.cartItems=[],this.cartTotal=0}ngOnInit(){var e=this;return(0,u.A)(function*(){(yield e.productService.isApiAvailable())?e.productService.getProductsAPI().subscribe(n=>{e.products=n}):e.products=yield e.productService.getProductsSQLite(),e.cartService.cartItems$.subscribe(n=>{e.cartItems=n,e.cartTotal=e.calculateTotal()})})()}calculateTotal(){return this.cartItems.reduce((e,i)=>e+i.total,0)}addToCart(e){var i=this;return(0,u.A)(function*(){var d;yield(yield i.alertController.create({header:`A\xf1adir ${e.nombre} al carrito`,inputs:[{name:"quantity",type:"number",min:1,max:e.stock,placeholder:"Cantidad"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"A\xf1adir",handler:(d=(0,u.A)(function*(p){const l=parseInt(p.quantity,10);l>0?yield i.cartService.addToCart(e,l,e.selectedWeight):console.warn("Cantidad no v\xe1lida.")}),function(l){return d.apply(this,arguments)})}]})).present()})()}editCartItemQuantity(e){var i=this;return(0,u.A)(function*(){var d;yield(yield i.alertController.create({header:`Editar cantidad de ${e.productName}`,inputs:[{name:"quantity",type:"number",value:e.quantity,min:1,placeholder:"Nueva cantidad"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Actualizar",handler:(d=(0,u.A)(function*(p){const l=parseInt(p.quantity,10);if(l>0&&l!==e.quantity){const C=l-e.quantity;if(e.quantity=l,e.total=l*e.price,e.selectedWeight)e.selectedWeight.stock-=C,yield i.productService.updateWeightOptionSQLite(e.selectedWeight),yield(0,h._)(i.productService.updateWeightOptionAPI(e.selectedWeight));else{const m=yield i.productService.getProductByIdSQLite(e.productId);m&&(m.stock-=C,yield i.productService.updateProductSQLite(m),yield(0,h._)(i.productService.updateProductAPI(m)))}i.cartService.updateCartItem(e),i.cartService.updateCartItemCount()}}),function(l){return d.apply(this,arguments)})}]})).present()})()}removeFromCart(e){var i=this;return(0,u.A)(function*(){var n;yield i.cartService.removeFromCart(e.productId,null===(n=e.selectedWeight)||void 0===n?void 0:n.id)})()}clearCart(){var e=this;return(0,u.A)(function*(){var n;yield(yield e.alertController.create({header:"Confirmar",message:"\xbfEst\xe1s seguro de que deseas vaciar el carrito?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Vaciar",handler:(n=(0,u.A)(function*(){yield e.cartService.clearCart()}),function(){return n.apply(this,arguments)})}]})).present()})()}goToPedidoAdd(){this.router.navigate(["/pedidos/pedido-add"])}}return(r=o).\u0275fac=function(e){return new(e||r)(t.rXU(y.m),t.rXU(I.b),t.rXU(c.hG),t.rXU(f.Ix))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-carrito-list"]],decls:10,vars:5,consts:[["color","primary"],[1,"ion-padding"],[4,"ngIf"],["expand","full","color","danger",3,"click",4,"ngIf"],["expand","full","color","success",3,"click",4,"ngIf"],["color","medium"],["class","cart-item",4,"ngFor","ngForOf"],[1,"cart-item"],["slot","start",1,"product-thumbnail"],[3,"src","alt"],[1,"product-info"],[1,"button-group"],["color","tertiary","expand","full",3,"click"],["color","danger","expand","full",3,"click"],["expand","full","color","danger",3,"click"],["expand","full","color","success",3,"click"]],template:function(e,i){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t.EFF(3,"Carrito de Compras"),t.k0s()()(),t.j41(4,"ion-content",1),t.DNE(5,F,4,0,"ion-card",2)(6,L,2,1,"ion-list",2)(7,j,6,3,"ion-card",2)(8,T,2,0,"ion-button",3)(9,k,2,0,"ion-button",4),t.k0s()),2&e&&(t.R7$(5),t.Y8G("ngIf",0===i.cartItems.length),t.R7$(),t.Y8G("ngIf",i.cartItems.length>0),t.R7$(),t.Y8G("ngIf",i.cartItems.length>0),t.R7$(),t.Y8G("ngIf",i.cartItems.length>0),t.R7$(),t.Y8G("ngIf",i.cartItems.length>0))},dependencies:[g.Sq,g.bT,c.Jm,c.b_,c.I9,c.W9,c.eU,c.uz,c.he,c.nf,c.IO,c.Zx,c.BC,c.ai,g.oe]}),o})()}];let E=(()=>{var r;class o{}return(r=o).\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[f.iI.forChild(x),f.iI]}),o})(),R=(()=>{var r;class o{}return(r=o).\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[g.MD,v.YN,c.bv,E]}),o})()}}]);